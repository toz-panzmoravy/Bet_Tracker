Ano, pojďme to sepsat jako jedno dlouhé, ale strukturované zadání, které můžeš rovnou hodit do Antigravity / Cursoru jako „specifikaci projektu“.

***

## 1. Cíl produktu

Vytvořit osobní „Bet Tracking & Analytics“ systém pro sportovní sázení, který:

- automaticky nebo polo‑automaticky ukládá tikety (primárně z Tipsportu) do databáze,  
- zobrazuje přehledné statistiky (profit, ROI, hit rate…),  
- umožňuje detailní filtrování (sport, liga, typ sázky, kurz, období…),  
- má moderní, pěkný webový dashboard,  
- obsahuje AI vrstvu, která umí nad statistikami generovat komentáře, doporučení a postřehy.

Nejdřív lokálně (Postgres + FastAPI + React/Next.js + Ollama), později nasaditelné na Supabase (DB) + Railway (backend) + libovolný hosting FE.

***

## 2. Technologický stack

### Backend

- Jazyk: **Python 3.x**  
- Framework: **FastAPI**  
- ORM: **SQLAlchemy** (nejlépe 2.x API)  
- Migrace: **Alembic**  
- DB lokálně: **PostgreSQL** (Docker)  
- Později DB: **Supabase Postgres** (kompatibilní s migracemi)  
- LLM vrstva:  
  - lokálně: **Ollama** (HTTP API, model pro OCR + model pro textovou analýzu)  
  - později: volitelně OpenAI / jiný provider skrz konfigurovatelný „LLM provider“ modul

### Frontend

- Framework: **Next.js (React)**  
- Stylování: **Tailwind CSS**  
- UI kit / dashboard: nějaký **React + Tailwind admin template** (TailAdmin / Mosaic / jiná OSS šablona)  
- Tabulky: **TanStack Table**  
- Grafy: **React ApexCharts** nebo **Recharts**

***

## 3. Funkční požadavky

### 3.1. Práce s tikety a sázkami

- Uživatel (já) může:
  - ručně přidat tiket přes UI (formulář).  
  - importovat tiket programově (endpoint pro import, který napojím později na Tipsport / OCR).  
- Systém podporuje:
  - SOLO, AKU, systémové tikety (tzn. vazba `ticket` ↔ `ticket_bets`).  
  - více bookmakerů (do budoucna, ale minimálně Tipsport).  
- Každá sázka má:
  - vazbu na event, sport, ligu  
  - typ sázky, kurz, vklad, status (open, won, lost, void, half‑win, half‑loss), profit

### 3.2. Statistiky a dashboard

- Hlavní dashboard zobrazuje:  
  - celkový profit, celkový vklad, **ROI**, hit rate  
  - počet sázek, počet tiketů  
  - timeframe filtr (např. posledních 7 dní, měsíc, 3 měsíce, custom range)  
- Filtrování:  
  - sport, liga, bookmaker, typ sázky, live vs prematch, kurzové pásmo (např. 1.01–1.50, 1.51–2.50, 2.51+)  
- Vizualizace:  
  - graf profitu v čase (denní / týdenní)  
  - ROI podle sportu (bar chart)  
  - ROI podle typu sázky / marketu (bar chart)  
  - rozložení vkladů a profitů podle kurzového pásma  
- Tabulky:  
  - přehled sázek (sortable, filtrovací řádka, pagination)  
  - přehled tiketů

### 3.3. AI analytická vrstva

- Na dashboardu (globálně i po aplikování filtrů) bude tlačítko „AI analýza“ / „Ask AI“.  
- Po kliknutí se:
  - odešle na backend aktuální filtr a kontext (např. „sport=football, date_from, date_to“).  
  - backend si z DB vytáhne agregované statistiky (ne raw tikety).  
- Backend vytvoří JSON s agregáty a pošle je do LLM (lokálně Ollama), např.:

```json
{
  "context": {
    "sport": "football",
    "date_range": {"from": "2025-01-01", "to": "2025-03-31"}
  },
  "overall": {
    "bets_count": 320,
    "tickets_count": 140,
    "stake_total": 25000,
    "profit_total": 1800,
    "roi_percent": 7.2,
    "hit_rate_percent": 53.4,
    "avg_odds": 1.92
  },
  "by_sport": [
    {"sport": "football", "bets_count": 250, "stake_total": 20000, "profit_total": 2300, "roi_percent": 11.5},
    {"sport": "hockey", "bets_count": 70, "stake_total": 5000, "profit_total": -500, "roi_percent": -10.0}
  ],
  "by_market_type": [
    {"market_type": "1X2", "bets_count": 150, "stake_total": 12000, "profit_total": 1000, "roi_percent": 8.3},
    {"market_type": "over_under", "bets_count": 100, "stake_total": 9000, "profit_total": -200, "roi_percent": -2.2}
  ],
  "by_odds_bucket": [
    {"bucket": "1.01-1.50", "bets_count": 80, "stake_total": 10000, "profit_total": -300, "roi_percent": -3.0},
    {"bucket": "1.51-2.50", "bets_count": 190, "stake_total": 13000, "profit_total": 2100, "roi_percent": 16.1},
    {"bucket": "2.51+", "bets_count": 50, "stake_total": 2000, "profit_total": 0, "roi_percent": 0}
  ]
}
```

- Prompt pro model (koncept):

> Jsi analytik sportovního sázení.  
> Dostaneš statistikická agregovaná data o sázkách jednoho sázkaře v JSONu.  
> Pracuj pouze s těmito daty, nic si nevymýšlej.  
> Identifikuj:
> 1) silné stránky (kde je ROI vysoká / stabilní),  
> 2) slabiny a „leaky“ (záporné ROI s velkým obratem),  
> 3) konkrétní doporučení: co omezit, co rozvinout, na co si dát pozor,  
> 4) případné upozornění na vysokou varianci.  
> Piš stručně, česky, v několika odstavcích a s odrážkami tam, kde se to hodí.

- Odpověď se zobrazí v UI jako textový blok + možno uložit „AI report“ (log).

***

## 4. Ne‑funkční požadavky

- Lokální vývoj:  
  - Docker Compose pro Postgres.  
  - FastAPI běží na localhost (uvicorn).  
  - Next.js dev server na localhost.  
- Přenositelnost do cloudu:  
  - DB schéma pod kontrolou migrací (Alembic).  
  - Žádné hard‑coded connection stringy, vše přes env proměnné (`DATABASE_URL`, `LLM_PROVIDER`, `LLM_API_KEY`).  
- Bezpečnost:  
  - lokálně: jednoduché auth (stačí basic token nebo single‑user režim),  
  - později: lze napojit na Supabase Auth (není nutné v MVP).

***

## 5. Datový model (ER nástřel)

Entity a vztahy:

- `bookmakers`  
  - id (PK)  
  - name (string)  
  - currency (string)

- `sports`  
  - id (PK)  
  - name (string)

- `leagues`  
  - id (PK)  
  - sport_id (FK → sports)  
  - name (string)  
  - country (string, nullable)

- `events`  
  - id (PK)  
  - league_id (FK → leagues)  
  - home_team (string)  
  - away_team (string)  
  - start_time (datetime)

- `tickets`  
  - id (PK)  
  - bookmaker_id (FK → bookmakers)  
  - ticket_number (string, unikátní per bookmaker, optional)  
  - total_stake (numeric)  
  - total_odds (numeric)  
  - created_at (datetime) – kdy jsem vsadil  
  - settled_at (datetime, nullable)  
  - status (enum: open, settled, cancelled)  

- `bets`  
  - id (PK)  
  - event_id (FK → events, nullable pokud event nechci detailně)  
  - sport_id (FK → sports, redundantně pro jednodušší query)  
  - league_id (FK → leagues, nullable)  
  - bet_type (string, např. „solo“, „parlay_leg“)  
  - market_type (string, např. „1X2“, „over_under“, „handicap“, „player_goals“)  
  - market_label (string, např. „Over 2.5 goals“)  
  - selection (string, např. „home“, „draw“, „over“, „under“, „player X“ atd.)  
  - odds (numeric)  
  - stake (numeric)  
  - is_live (bool)  
  - placed_at (datetime)  
  - status (enum: open, won, lost, void, half_win, half_loss)  
  - payout (numeric, nullable)  
  - profit (numeric, může být vypočítán nebo uložen)  

- `ticket_bets`  
  - id (PK)  
  - ticket_id (FK → tickets)  
  - bet_id (FK → bets)  
  - ratio / weight (nullable – pro systémové tikety, pokud bude potřeba)  

- `ai_analyses` (log)  
  - id (PK)  
  - created_at (datetime)  
  - context (JSON – použité filtry)  
  - aggregates (JSON – co se poslalo modelu)  
  - model_name (string)  
  - response_text (text)

***

## 6. API návrh (backend)

### 6.1. Základní REST API

- `POST /api/tickets` – vytvoření tiketu (s nested bets nebo jen metadata).  
- `GET /api/tickets` – list s filtrováním (date_from, date_to, bookmaker, status).  
- `GET /api/tickets/{id}` – detail tiketu (včetně bets).  
- `POST /api/bets` – přidání samostatné sázky (pokročilé scénáře).  
- `GET /api/bets` – list sázky + filtry (sport, liga, market_type, odds_range, is_live, status).  
- `GET /api/stats/overview` – hlavní agregáty pro dashboard:
  - vstupy: `date_from`, `date_to`, `sport`, `league`, `bookmaker`, `is_live`, `odds_min`, `odds_max`  
  - výstup: `overall`, `by_sport`, `by_market_type`, `by_odds_bucket` (formát podobný JSON výše)  
- `GET /api/stats/timeseries` – profit/ROI v čase (daily / weekly).  

### 6.2. AI endpoint

- `POST /api/ai/analyze`  
  - body:  
    - `filters` (stejná struktura jako pro stats/overview)  
    - volitelně `question` (text – co konkrétně chci)  
  - backend:  
    - zavolá interní funkci, která udělá stejné agregace jako `/stats/overview` + případně další (by_league).  
    - sestaví JSON + prompt.  
    - zavolá LLM (Ollama/externí).  
    - uloží do `ai_analyses`.  
  - response:  
    - `analysis_text`, `used_filters`, `aggregates_summary`.

***

## 7. Frontend – stránky a UX

### Hlavní stránky

1. **Dashboard**
   - horní KPI karty: profit, ROI, hit rate, obrátka, počet sázek  
   - časový filtr + základní filtry (sport, bookmaker)  
   - graf profit v čase  
   - bar chart ROI podle sportu  
   - bar chart ROI podle typu marketu  
   - tlačítko „AI analýza“ → otevře modal s výsledkem

2. **Sázky (Bets list)**  
   - tabulka s: datum, sport, liga, event, typ, kurz, stake, výsledek, profit  
   - filtry (sport, liga, status, odds range, live/prematch)  
   - možnost kliknout na sázku → detail  

3. **Tikety (Tickets list)**  
   - tabulka s: datum, bookmaker, číslo tiketu, počet sázek, total stake, total odds, status, payout, profit  
   - filtr podle bookmaker, času, statusu  
   - detail tiketu s rozpisem sázek

4. **Nastavení / Modely**  
   - konfigurace LLM provider (Ollama vs externí), jméno modelu, max tokens, temperature atd.  
   - případně možnost vypnout/skrýt AI funkce.

***

## 8. Vývojový workflow (pro Antigravity / Cursor)

1. Vytvořit monorepo strukturu:
   - `/backend` – FastAPI + SQLAlchemy + Alembic  
   - `/frontend` – Next.js + Tailwind + admin template  
   - `/docker` – Docker Compose pro Postgres (případně i Ollama)  

2. Nejprve v backendu:
   - definovat SQLAlchemy modely dle datového modelu  
   - vygenerovat první Alembic migraci  
   - implementovat `/api/bets`, `/api/tickets`, `/api/stats/overview`  
3. Pak FE:
   - připojení na backend, vytvořit Dashboard, Bets list, Tickets list  
   - přidat filtry + grafy  
4. Nakonec AI:
   - přidat modul `llm_client` v backendu (abstrakce nad Ollama / externí API)  
   - implementovat `/api/ai/analyze` podle JSON formátu výše  
   - FE: tlačítko „AI analýza“ + modal s výsledkem.

***

Tohle zadání můžeš vzít, lehce doplnit osobní detaily (jazyk UI, názvy sekcí) a vložit do Antigravity/Cursoru jako „Project spec“ / „Generate project skeleton“.  

Chceš jako další krok ode mě konkrétní „prompt“ text, který jen zkopíruješ do Cursoru (včetně instrukcí, jak projekt rozsekat na tasky)?